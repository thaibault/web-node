#!/usr/bin/env node
// -*- coding: utf-8 -*-
'use strict';
module.exports=function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={i:d,l:!1,exports:{}};return a[d].call(e.exports,e,e.exports,b),e.l=!0,e.exports}var c={};return b.m=a,b.c=c,b.d=function(a,c,d){b.o(a,c)||Object.defineProperty(a,c,{configurable:!1,enumerable:!0,get:d})},b.n=function(a){var c=a&&a.__esModule?function(){return a['default']}:function(){return a};return b.d(c,'a',c),c},b.o=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},b.p='',b(b.s=16)}([function(a){a.exports=require('clientnode')},function(a){a.exports=require('source-map-support/register')},function(a){a.exports=require('fs')},function(a){a.exports=require('path')},function(module,exports,__webpack_require__){'use strict';(function(__dirname){function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}exports.__esModule=!0,exports.configuration=void 0;var _clientnode=__webpack_require__(0),_clientnode2=_interopRequireDefault(_clientnode),_fs=__webpack_require__(2),_fs2=_interopRequireDefault(_fs),_path=__webpack_require__(3),_path2=_interopRequireDefault(_path),_pluginAPI=__webpack_require__(5),_pluginAPI2=_interopRequireDefault(_pluginAPI),_package=__webpack_require__(8),_package2=_interopRequireDefault(_package);try{__webpack_require__(1)}catch(a){}for(_package2.default.webNode.context={path:__dirname};_package2.default.webNode.context.path=_path2.default.resolve(_package2.default.webNode.context.path,'../../'),'node_modules'===_path2.default.basename(_path2.default.dirname(_package2.default.webNode.context.path)););if('/'===_package2.default.webNode.context.path||'node_modules'===_path2.default.basename(_path2.default.dirname(process.cwd()))||'.staging'===_path2.default.basename(_path2.default.dirname(process.cwd()))&&'node_modules'===_path2.default.basename(_path2.default.dirname(_path2.default.dirname(process.cwd()))))_package2.default.webNode.context.path=process.cwd();else try{_fs2.default.lstatSync(_path2.default.join(process.cwd(),'node_modules')).isSymbolicLink()&&(_package2.default.webNode.context.path=process.cwd())}catch(a){}let specificConfiguration={};try{specificConfiguration=eval('require')(_path2.default.join(_package2.default.webNode.context.path,'package'))}catch(a){_package2.default.webNode.context.path=process.cwd()}const name=specificConfiguration.hasOwnProperty('documentationWebsite')&&specificConfiguration.documentationWebsite.name||specificConfiguration.name;specificConfiguration=specificConfiguration.webNode||{},name&&(specificConfiguration.name=name),_package2.default.webNode.name=_package2.default.documentationWebsite.name;const now=new Date,scope={currentPath:process.cwd(),fileSystem:_fs2.default,path:_path2.default,PluginAPI:_pluginAPI2.default,require:eval('require'),Tools:_clientnode2.default,webNodePath:__dirname,now,nowUTCTimestamp:_clientnode2.default.numberGetUTCTimestamp(now)};let configuration=exports.configuration=_clientnode2.default.evaluateDynamicDataStructure(_package2.default.webNode,scope);if(delete _package2.default.webNode,_clientnode2.default.extendObject(!0,_clientnode2.default.modifyObject(configuration,specificConfiguration),specificConfiguration),2<process.argv.length){const a=_clientnode2.default.stringParseEncodedObject(process.argv[process.argv.length-1],configuration,'configuration');_clientnode2.default.isPlainObject(a)&&(_clientnode2.default.extendObject(!0,_clientnode2.default.modifyObject(configuration,a),a),configuration.runtimeConfiguration=a)}const removePropertiesInDynamicObjects=(a)=>{for(const b in a)a.hasOwnProperty(b)&&!['__evaluate__','__execute__'].includes(b)&&(a.hasOwnProperty('__evaluate__')||a.hasOwnProperty('__execute__'))?delete a[b]:'object'==typeof a[b]&&null!==a[b]&&removePropertiesInDynamicObjects(a[b]);return a};exports.configuration=configuration=_clientnode2.default.evaluateDynamicDataStructure(removePropertiesInDynamicObjects(configuration),scope),configuration.package=_package2.default,exports.configuration=configuration=_clientnode2.default.copy(configuration,-1,!0),exports.default=configuration}).call(exports,'/')},function(module,exports,__webpack_require__){'use strict';(function(__dirname){function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}var _asyncToGenerator2=__webpack_require__(6),_asyncToGenerator3=_interopRequireDefault(_asyncToGenerator2),_child_process=__webpack_require__(7),_clientnode=__webpack_require__(0),_clientnode2=_interopRequireDefault(_clientnode),_fs=__webpack_require__(2),_fs2=_interopRequireDefault(_fs),_path=__webpack_require__(3),_path2=_interopRequireDefault(_path),_configurator=__webpack_require__(4),_configurator2=_interopRequireDefault(_configurator);exports.__esModule=!0,exports.PluginAPI=void 0;try{__webpack_require__(1)}catch(a){}class PluginAPI{static callStack(a,b,c,d=null,...e){return(0,_asyncToGenerator3.default)(function*(){if(c.plugin.hotReloading&&!['configurationLoaded','apiFileReloaded'].includes(a)){const a=PluginAPI.hotReloadFile('configurationFile','configuration',b);a.length&&(PluginAPI.callStack('preConfigurationLoaded',b,c,c,a),PluginAPI.loadConfigurations(b,c),PluginAPI.callStack('postConfigurationLoaded',b,c,c,a));const d=PluginAPI.hotReloadFile('apiFile','scope',b);d.length&&PluginAPI.callStack('apiFileReloaded',b,c,a)}for(const f of b)if(f.api){let g;try{g=yield f.api.call(PluginAPI,a,d,...e.concat([c,b]))}catch(b){if('message'in b&&b.message.startsWith('NotImplemented:'))continue;throw new Error(`Plugin "${f.internalName}" `+(f.internalName===f.name?'':`(${f.name}) `)+`throws: ${_clientnode2.default.representObject(b)} during `+`asynchrone hook "${a}".`)}d=g,c.debug&&console.info(`Ran asynchrone hook "${a}" for plugin "`+`${f.name}".`)}return d})()}static callStackSynchronous(a,b,c,d=null,...e){for(const f of b)if(f.api){let g;try{g=f.api.call(PluginAPI,a,d,...e.concat([c,b]))}catch(b){if('message'in b&&b.message.startsWith('NotImplemented:'))continue;throw new Error(`Plugin "${f.internalName}" `+(f.internalName===f.name?'':`(${f.name}) `)+`throws: ${_clientnode2.default.representObject(b)} during `+`synchrone hook "${a}".`)}d=g,c.debug&&console.info(`Ran synchrone hook "${a}" for plugin "`+`${f.name}".`)}return d}static hotReloadFile(type,targetType,plugins){const pluginsWithChangedFiles=[];for(const plugin of plugins)if(plugin[type]){const timestamp=_fs2.default.statSync(plugin[`${type}Path`]).mtime.getTime();plugin[`${type}LoadTimestamp`]<timestamp&&(delete eval('require').cache[eval('require').resolve(plugin[type])],plugin[targetType]=PluginAPI.loadFile(plugin[type],plugin.name,plugin[targetType]),pluginsWithChangedFiles.push(plugin)),plugin[`${type}LoadTimestamp`]=timestamp}return pluginsWithChangedFiles}static load(a,b,c,d,e,f='utf8'){return(0,_asyncToGenerator3.default)(function*(){let g=_path2.default.resolve(e,'package.json'),h=null;g&&(yield _clientnode2.default.isDirectory(e))&&(yield _clientnode2.default.isFile(g))&&(h=PluginAPI.loadFile(g,a));let i='index.js';if(h){const j=_clientnode2.default.copy(h,-1,!0);for(const k of d)if(h.hasOwnProperty(k)){h.hasOwnProperty('main')&&(i=h.main);const d=h[k];return d.package=j,delete d.package[k],yield PluginAPI.loadAPI(i,e,a,b,c,f,d,g)}return yield PluginAPI.loadAPI(i,e,a,b,c,f,{package:j},g)}return yield PluginAPI.loadAPI(i,e,a,b,c,f)})()}static loadAPI(a,b,c,d,e,f='utf8',g=null,h=null){return(0,_asyncToGenerator3.default)(function*(){let i=_path2.default.resolve(b,a);if(!(yield _clientnode2.default.isFile(i)))for(const a of _fs2.default.readdirSync(b))if('package.json'!==a&&(yield _clientnode2.default.isFile(_path2.default.resolve(b,a)))&&(i=_path2.default.resolve(b,i),['index','main'].includes(_path2.default.basename(i,_path2.default.extname(a)))))break;let j=null;return(yield _clientnode2.default.isFile(i))&&(i.endsWith('.js')?j=function(a,b,...d){if(a in e[c].scope)return e[c].scope[a](b,...d);throw new Error(`NotImplemented: API method "${a}" is not `+`implemented in plugin "${c}".`)}:j=function(a,...b){const c=(0,_child_process.spawnSync)(i,_clientnode2.default.arrayMake(b),{cwd:process.cwd(),encoding:f,env:process.env,input:_clientnode2.default.representObject(a),shell:!0,stdio:'inherit'});return c.stdout.startsWith('##')&&c.stdout.endsWith('##')&&(a=JSON.parse(a)),a}),{api:j,apiFilePath:j&&i,apiFileLoadTimestamp:j&&_fs2.default.statSync(i).mtime.getTime(),configuration:g,configurationFilePath:h,configurationFileLoadTimestamp:h&&_fs2.default.statSync(h).mtime.getTime()||null,dependencies:g&&g.hasOwnProperty('dependencies')&&g.dependencies||[],internalName:d,name:c,path:b,scope:j&&PluginAPI.loadFile(i,c)}})()}static loadConfigurations(plugins,configuration){for(const a in configuration)configuration.hasOwnProperty(a)&&delete configuration[a];_clientnode2.default.extendObject(configuration,_clientnode2.default.copy(_configurator2.default,-1,!0));for(const a of plugins)if(a.configuration){const b=_clientnode2.default.copy(a.configuration,-1,!0);delete b.package,_clientnode2.default.extendObject(!0,_clientnode2.default.modifyObject(configuration,b),b),configuration.runtimeConfiguration&&_clientnode2.default.extendObject(!0,configuration,configuration.runtimeConfiguration)}const now=new Date,packageConfiguration=configuration.package;return delete configuration.package,configuration=_clientnode2.default.evaluateDynamicDataStructure(PluginAPI.removePropertiesInDynamicObjects(configuration),{currentPath:process.cwd(),fileSystem:_fs2.default,path:_path2.default,PluginAPI,require:eval('require'),Tools:_clientnode2.default,webNodePath:__dirname,now,nowUTCTimestamp:_clientnode2.default.numberGetUTCTimestamp(now)}),configuration.package=packageConfiguration,configuration}static loadFile(filePath,name,fallbackScope=null,log=!0){let scope;try{scope=eval('require')(filePath)}catch(a){if(fallbackScope)scope=fallbackScope,log&&console.warn(`Couln't load new api plugin file "${filePath}" for `+`plugin "${name}": ${_clientnode2.default.representObject(a)}. `+`Using fallback one.`);else throw new Error(`Couln't load plugin file "${filePath}" for plugin "`+`${name}": ${_clientnode2.default.representObject(a)}`)}return scope.hasOwnProperty('default')?scope.default:scope}static loadAll(a){return(0,_asyncToGenerator3.default)(function*(){const b={};for(const c in'webNode'!==a.name&&(b[a.name]=yield PluginAPI.load(a.name,a.name,b,a.plugin.configurationPropertyNames,a.context.path,a.encoding)),a.plugin.directories)if(a.plugin.directories.hasOwnProperty(c)&&(yield _clientnode2.default.isDirectory(a.plugin.directories[c].path))){const d=new RegExp(a.plugin.directories[c].nameRegularExpressionPattern);for(const e of _fs2.default.readdirSync(a.plugin.directories[c].path)){if(!d.test(e))continue;const f=_path2.default.resolve(a.plugin.directories[c].path,e),g=e.replace(d,function(a,b){return'string'==typeof b?b:a});b[e]=yield PluginAPI.load(e,g,b,a.plugin.configurationPropertyNames,f,a.encoding)}}const c={};for(const d in b)if(b.hasOwnProperty(d)&&(c[b[d].internalName]=b[d].dependencies,a.interDependencies.hasOwnProperty(b[d].internalName)))for(const e of[].concat(a.interDependencies[b[d].internalName]))c[b[d].internalName].includes(e)||c[b[d].internalName].push(e);const d=[];for(const a of _clientnode2.default.arraySortTopological(c))for(const c in b)if(b.hasOwnProperty(c)&&[b[c].internalName,c].includes(a)){d.push(b[c]);break}return{plugins:d,configuration:PluginAPI.loadConfigurations(d,a)}})()}static removePropertiesInDynamicObjects(a){for(const b in a)a.hasOwnProperty(b)&&!['__evaluate__','__execute__'].includes(b)&&(a.hasOwnProperty('__evaluate__')||a.hasOwnProperty('__execute__'))?delete a[b]:'object'==typeof a[b]&&null!==a[b]&&PluginAPI.removePropertiesInDynamicObjects(a[b]);return a}}exports.PluginAPI=PluginAPI,exports.default=PluginAPI}).call(exports,'/')},function(a){a.exports=require('babel-runtime/helpers/asyncToGenerator')},function(a){a.exports=require('child_process')},function(a){a.exports={name:'web-node',version:'1.0.156',license:'CC-BY-3.0',description:'High level javaScript backend plugin system and configuration merger.',homepage:'http://torben.website/webNode',documentationWebsite:{name:'webNode',trackingCode:'UA-40192634-9'},keywords:['web','backend','api','plugin','management'],files:['configurator.compiled.js','configurator.js','index.js','pluginAPI.compiled.js','pluginAPI.js','type.js','unixCrypt.compiled.js','unixCrypt.js'],main:'index.compiled.js',bin:{webNode:'index.compiled.js'},repository:{type:'git',url:'https://github.com/thaibault/webNode.git'},scripts:{build:'webOptimizer build',"build:dll":'webOptimizer build:dll',clear:'webOptimizer clear && rm --force log.txt &>/dev/null',document:'webOptimizer document',lint:'webOptimizer check:type; webOptimizer lint',prepare:'npm run build',"report:coverage":'nyc report --reporter=text-lcov | coveralls',serve:'webOptimizer build && ./index.compiled.js',start:'npm run serve',test:'cd dummyPlugin && npm run build && cd - && nyc webOptimizer test',"test:plain":'cd dummyPlugin && npm run build && cd - && webOptimizer test',update:'npm version patch && npm publish',"update:documentation":'documentationWebsite --log-level info',watch:'webOptimizer build --watch',"watch:dll":'webOptimizer build:dll --watch'},dependencies:{clientnode:'^1.0.346',keypress:'^0.2.1'},peerDependencies:{"babel-runtime":'*'},devDependencies:{"babel-cli":'^6.24.1',"babel-eslint":'^8.2.2',coveralls:'^3.0.0',"documentation-website":'^1.0.103',eslint:'^4.18.1',"eslint-config-google":'^0.9.1',"eslint-plugin-flowtype":'^2.45.0',"eslint-plugin-jsdoc":'^3.5.0',"flow-bin":'^0.66.0',jsdoc:'^3.5.2',nyc:'^11.5.0',qunit:'^2.5.0',"source-map-support":'^0.5.3',weboptimizer:'^1.0.527',webpack:'^3.11.0',"webpack-dev-server":'^2.10.1'},webNode:{debug:!1,encoding:'utf8',interDependencies:{},plugin:{configurationPropertyNames:['webNode'],directories:{internal:{path:{__evaluate__:'`${currentPath}/plugins/`'},nameRegularExpressionPattern:'^([a-zA-Z].*)$'},external:{path:{__evaluate__:'`${currentPath}/node_modules/`'},nameRegularExpressionPattern:'^([a-z][a-zA-Z0-9]+)[wW]eb[nN]ode[pP]lugin$'}},hotReloading:!0}},webOptimizer:{assetPattern:{javaScript:{pattern:'#!/usr/bin/env node\n// -*- coding: utf-8 -*-\n\'use strict\';\n{1}\n'}},exportFormat:{external:'commonjs2',self:'commonjs2'},injection:{internal:{__evaluate__:'2 < self.givenCommandLineArguments.length && self.givenCommandLineArguments[2] === \'test\' ? \'test\' : {configurator: \'./configurator\', index: \'./index\', pluginAPI: \'./pluginAPI\', unixCrypt: \'./unixCrypt\'}'}},module:{aliases:{"clientnode/test$":'clientnode/test.compiled'},optimizer:{babelMinify:{module:{mangle:!1}}}},targetTechnology:'node'}}},,,,,,,,function(a,b,c){a.exports=c(5)}]);
