#!/usr/bin/env node
// -*- coding: utf-8 -*-
'use strict';if(typeof module!=='undefined'&&module!==null&&eval('typeof require')!=='undefined'&&eval('require')!==null&&'main'in eval('require')&&eval('typeof require.main')!=='undefined'&&eval('require.main')!==null){var ORIGINAL_MAIN_MODULE=module;if(module!==eval('require.main')&&'paths'in module&&'paths'in eval('require.main')&&typeof __dirname!=='undefined'&&__dirname!==null)module.paths=eval('require.main.paths').concat(module.paths.filter(function(path){return eval('require.main.paths').includes(path)}))};if(module===eval('require.main'))module.paths.unshift('/application/node_modules');(()=>{"use strict";var __webpack_modules__=[(e,_,r)=>{r.d(_,{D:()=>m,Z:()=>D});var t=r(5),n=r.n(t),a=r(6),o=r.n(a),i=r(7),c=r.n(i),l=r(1);const u=JSON.parse('{"name":"web-node","version":"1.0.442","description":"High level javaScript backend plugin system and configuration merger.","keywords":["web","backend","api","plugin","management"],"homepage":"https://torben.website/web-node","bugs":{"email":"info@torben.website","url":"https://github.com/thaibault/web-node/issues"},"license":"CC-BY-3.0","author":{"name":"Torben Sickert","email":"info@torben.website","url":"https://torben.website"},"files":["configurator.d.ts","index.d.ts","index.js","pluginAPI.d.ts","type.d.ts","unixCrypt.d.ts","unixCrypt.js"],"bin":{"web-node":"index.js"},"repository":{"type":"git","url":"https://github.com/thaibault/web-node.git"},"scripts":{"build":"yarn build:types; yarn build:plain","build:plain":"weboptimizer build","build:types":"weboptimizer build:types","check":"yarn check:types; yarn lint","check:types":"weboptimizer check:types","clear":"weboptimizer clear","document":"weboptimizer document","lint":"weboptimizer lint","prepare":"yarn build","serve":"weboptimizer build && yarn serve","start":"./index.js \'{plugin: {hotReloading: true}}\'","prepare:test":"yarn clear && cd dummyPlugin && yarn build && cd ..","test":"yarn prepare:test && weboptimizer test","test:coverage":"yarn prepare:test && weboptimizer test:coverage","test:coverage:report":"yarn prepare:test && weboptimizer test:coverage:report","update":"yarn version --patch && yarn publish","update:documentation":"documentation-website","watch":"weboptimizer build --watch"},"dependencies":{"@types/webpack":"https://registry.yarnpkg.com/@favware/skip-dependency/-/skip-dependency-1.1.1.tgz"},"devDependencies":{"@babel/cli":"*","@babel/eslint-parser":"*","@types/node":"*","@typescript-eslint/eslint-plugin":"*","@typescript-eslint/parser":"*","clientnode":"*","documentation-website":"*","eslint":"*","eslint-config-google":"*","eslint-plugin-jsdoc":"*","jest":"*","jsdoc":"*","weboptimizer":"*"},"peerDependencies":{"@babel/runtime":"*","clientnode":"*"},"peerDependenciesMeta":{"@babel/runtime":{"optional":true}},"engines":{"node":">=17","npm":">=7"},"resolutions":{"@types/webpack":"https://registry.yarnpkg.com/@favware/skip-dependency/-/skip-dependency-1.1.1.tgz","colors":"1.4.0"},"sideEffects":true,"documentationWebsite":{"name":"web-node","trackingCode":"UA-40192634-9"},"webNode":{"core":{"context":{"path":"./","type":"relative"},"debug":false,"encoding":"utf8","interDependencies":{},"name":"web-node","plugin":{"configuration":{"fileNames":["package.json","private-package.json"],"propertyNames":["webNode","webnode","web-node"]},"directories":{"external":{"nameRegularExpressionPattern":"^([a-zA-Z0-9-]+?)-?[wW]eb-?[nN]ode-?[pP]lugin$","path":{"__evaluate__":"`${currentPath}/node_modules/`"}},"internal":{"nameRegularExpressionPattern":"^([a-zA-Z0-9-_].*)$","path":{"__evaluate__":"`${currentPath}/plugins/`"}}},"hotReloading":false}}},"webOptimizer":{"assetPattern":{"javaScript":{"includeFilePathRegularExpression":"^(.+/)?index\\\\.js$","pattern":{"#":"This is how we can make our main exported artefact executable.","__evaluate__":"`#!/usr/bin/env node\\n// -*- coding: utf-8 -*-\\n${self.generic.assetPattern.javaScript.pattern}if(module===eval(\'require.main\'))module.paths.unshift(\'/application/node_modules\');{1}`"}}},"exportFormat":{"external":"commonjs2","self":"commonjs2"},"injection":{"entry":{"__evaluate__":"2 < self.givenCommandLineArguments.length && self.givenCommandLineArguments[2].startsWith(\'test\') ? {testBundle: \'test\'} : {index: \'./index.ts\', unixCrypt: \'./unixCrypt.ts\'}"}},"module":{"optimizer":{"babelMinify":{"#":"To provide a logging output we need to exclude this feature.","__evaluate__":"self.debug ? {bundle: null, module: null} : {bundle: {transform: {removeConsole: false}}, module: {removeConsole: false}}"}}},"targetTechnology":{"boilerplate":"node","payload":"node"}}}');var s,p;for(u.webNode.core.context={path:"/",type:"relative"};u.webNode.core.context.path=c().resolve(u.webNode.core.context.path,"../../"),"node_modules"===c().basename(c().dirname(u.webNode.core.context.path)););if("/"===u.webNode.core.context.path||"node_modules"===c().basename(c().dirname(process.cwd()))||".staging"===c().basename(c().dirname(process.cwd()))&&"node_modules"===c().basename(c().dirname(c().dirname(process.cwd()))))u.webNode.core.context.path=process.cwd();else try{(0,a.lstatSync)(c().join(process.cwd(),"node_modules")).isSymbolicLink()&&(u.webNode.core.context.path=process.cwd())}catch(e){}var d={name:"main"};try{d=(0,t.currentRequire)(c().join(u.webNode.core.context.path,"package"))}catch(e){u.webNode.core.context.path=process.cwd()}var E=(null==(s=d.documentationWebsite)?void 0:s.name)||d.name||"main",f=d.webNode||((p={})[E]={name:E,package:d},p);u.webNode.core.name=u.documentationWebsite.name;var b=new Date,P={currentPath:process.cwd(),fileSystem:o(),path:c(),PluginAPI:l.ZP,require:t.currentRequire,Tools:n(),webNodePath:"/",now:b,nowUTCTimestamp:n().numberGetUTCTimestamp(b)},m=n().evaluateDynamicData(u.webNode,P);if(delete u.webNode,n().extend(!0,n().modifyObject(m,f),f),2<process.argv.length){var O=n().stringParseEncodedObject(process.argv[process.argv.length-1],m,"configuration");n().isPlainObject(O)&&(n().extend(!0,n().modifyObject(m,O),O),m.core.runtimeConfiguration=O)}(m=n().evaluateDynamicData(n().removeKeysInEvaluation(m),P)).name=E,m.core.package=u;const D=m},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{var __dirname="/";__webpack_require__.d(__webpack_exports__,{Jf:()=>currentRequire,Sw:()=>PluginAPI,ZP:()=>__WEBPACK_DEFAULT_EXPORT__});var _babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(3),_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_0__),_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(4),_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1__),child_process__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(8),child_process__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(child_process__WEBPACK_IMPORTED_MODULE_2__),clientnode__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(5),clientnode__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(clientnode__WEBPACK_IMPORTED_MODULE_3__),fs__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(6),fs__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(fs__WEBPACK_IMPORTED_MODULE_4__),module__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(9),module__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(module__WEBPACK_IMPORTED_MODULE_5__),path__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(7),path__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_6__),_configurator__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(0);function _createForOfIteratorHelperLoose(e,_){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=_unsupportedIterableToArray(e))||_&&e&&"number"==typeof e.length){r&&(e=r);var t=0;return function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,_){if(e){if("string"==typeof e)return _arrayLikeToArray(e,_);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,_):void 0}}function _arrayLikeToArray(e,_){(null==_||_>e.length)&&(_=e.length);for(var r=0,t=Array(_);r<_;r++)t[r]=e[r];return t}var currentRequire=eval("require"),oldResolveFilename=module__WEBPACK_IMPORTED_MODULE_5__.Module._resolveFilename;module__WEBPACK_IMPORTED_MODULE_5__.Module._resolveFilename=function(e,_,r){return oldResolveFilename("web-node"===e?currentRequire.main.id:e,_,r)};var PluginAPI=function(){function e(){}return e.callStack=function(){var _=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_0___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default().mark((function _(r,t,n,a){var o,i,c,l,u,s,p,d,E,f,b=arguments;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default().wrap((function(_){for(;;)switch(_.prev=_.next){case 0:if(void 0===a&&(a=null),!n.core.plugin.hotReloading){_.next=15;break}if(!(o=e.hotReloadConfigurationFile(t,n.core.plugin.configuration.propertyNames)).length){_.next=10;break}return n.core.debug&&console.info('Configuration for "'+o.map((function(e){return e.name})).join('", "')+'" has been changed: reloading initialized.'),_.next=7,e.callStack("preConfigurationLoaded",t,n,n,o);case 7:return e.loadConfigurations(t,n),_.next=10,e.callStack("postConfigurationLoaded",t,n,n,o);case 10:if(!(i=e.hotReloadAPIFile(t)).length){_.next=15;break}return n.core.debug&&console.info('API-file for "'+i.map((function(e){return e.name})).join('", "')+'" has been changed: reloading initialized.'),_.next=15,e.callStack("apiFileReloaded",t,n,i);case 15:for(c=b.length,l=Array(4<c?c-4:0),u=4;u<c;u++)l[u-4]=b[u];s=_createForOfIteratorHelperLoose(t);case 17:if((p=s()).done){_.next=36;break}if(!(d=p.value).api){_.next=34;break}return E=void 0,_.prev=21,_.next=24,d.api.apply(d,[r,a].concat(l.concat(r.endsWith("ConfigurationLoaded")?[]:n,[t])));case 24:E=_.sent,_.next=32;break;case 27:if(_.prev=27,_.t0=_.catch(21),null==(f=_.t0.message)||!f.startsWith("NotImplemented:")){_.next=31;break}return _.abrupt("continue",34);case 31:throw new Error('Plugin "'+d.internalName+'" '+(d.internalName===d.name?"":"("+d.name+") ")+"throws: "+clientnode__WEBPACK_IMPORTED_MODULE_3___default().represent(_.t0)+' during asynchronous hook "'+r+'".');case 32:a=E,n.core.debug&&console.info('Ran asynchronous hook "'+r+'" for plugin "'+d.name+'".');case 34:_.next=17;break;case 36:return _.abrupt("return",a);case 37:case"end":return _.stop()}}),_,null,[[21,27]])})));return function(){return _.apply(this,arguments)}}(),e.callStackSynchronous=function(e,_,r,t){void 0===t&&(t=null);for(var n=arguments.length,a=Array(4<n?n-4:0),o=4;o<n;o++)a[o-4]=arguments[o];for(var i,c,l=_createForOfIteratorHelperLoose(_);!(i=l()).done;)if((c=i.value).api){var u=void 0;try{u=c.api.apply(c,[e,t].concat(a.concat(r,_)))}catch(_){var s;if(null!=(s=_.message)&&s.startsWith("NotImplemented:"))continue;throw new Error('Plugin "'+c.internalName+'" '+(c.internalName===c.name?"":"("+c.name+") ")+"throws: "+clientnode__WEBPACK_IMPORTED_MODULE_3___default().represent(_)+' during synchronous hook "'+e+'".')}t=u,r.core.debug&&console.info('Ran synchronous hook "'+e+'" for plugin "'+c.name+'".')}return t},e.determineInternalName=function(e,_){return clientnode__WEBPACK_IMPORTED_MODULE_3___default().stringDelimitedToCamelCase(e.replace(_,(function(e,_){return"string"==typeof _?_:e})))},e.evaluateConfiguration=function(_){for(var r={},t=0,n=Object.entries(_);t<n.length;t++){var a=n[t],o=a[0],i=a[1];i.package&&(r[o]=i.package,delete i.package)}var c=new Date;_=clientnode__WEBPACK_IMPORTED_MODULE_3___default().evaluateDynamicData(clientnode__WEBPACK_IMPORTED_MODULE_3___default().removeKeysInEvaluation(_),{currentPath:process.cwd(),fileSystem:fs__WEBPACK_IMPORTED_MODULE_4___default(),path:path__WEBPACK_IMPORTED_MODULE_6___default(),PluginAPI:e,require:currentRequire,Tools:clientnode__WEBPACK_IMPORTED_MODULE_3___default(),webNodePath:__dirname,now:c,nowUTCTimestamp:clientnode__WEBPACK_IMPORTED_MODULE_3___default().numberGetUTCTimestamp(c)});for(var l=0,u=Object.entries(r);l<u.length;l++){var s=u[l],p=s[0],d=s[1];_[p].package=d}return _},e.hotReloadAPIFile=function(_){for(var r,t,n=[],a=_createForOfIteratorHelperLoose(e.hotReloadFiles("api","scope",_));!(r=a()).done;)if((t=r.value).oldScope){for(var o=0,i=Object.entries(t.oldScope);o<i.length;o++){var c=i[o],l=c[0],u=c[1];Object.prototype.hasOwnProperty.call(t.newScope,l)&&!clientnode__WEBPACK_IMPORTED_MODULE_3___default().isFunction(t.newScope[l])&&(t.newScope[l]=u)}n.push(t.plugin)}return n},e.hotReloadConfigurationFile=function(_,r){for(var t,n,a=[],o=_createForOfIteratorHelperLoose(e.hotReloadFiles("configuration","packageConfiguration",_));!(t=o()).done;)(n=t.value).plugin.configuration=e.loadConfiguration(n.plugin.internalName,n.plugin.packageConfiguration,r),a.push(n.plugin);return a},e.hotReloadFiles=function(_,r,t){for(var n,a,o=[],i=_createForOfIteratorHelperLoose(t);!(n=i()).done;)if((a=n.value)[r])for(var c,l=0,u=_createForOfIteratorHelperLoose(a[_+"FilePaths"]);!(c=u()).done;){var s=c.value,p=(0,fs__WEBPACK_IMPORTED_MODULE_4__.statSync)(s).mtime.getTime();if(a[_+"FileLoadTimestamps"][l]<p){delete currentRequire.cache[currentRequire.resolve(s)];var d=a[r];a[r]=e.loadFile(s,a.name,a[r]),o.push({newScope:a[r],oldScope:d,plugin:a,target:r})}a[_+"FileLoadTimestamps"][l]=p,l+=1}return o},e.load=function(){var _=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_0___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default().mark((function _(r,t,n,a,o,i){var c,l,u,s,p,d,E,f;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default().wrap((function(_){for(;;)switch(_.prev=_.next){case 0:void 0===i&&(i="utf8"),c=[],l={},u=_createForOfIteratorHelperLoose(a.fileNames);case 4:if((s=u()).done){_.next=14;break}return p=s.value,d=(0,path__WEBPACK_IMPORTED_MODULE_6__.resolve)(o,p),_.next=9,clientnode__WEBPACK_IMPORTED_MODULE_3___default().isFile(d);case 9:if(!_.sent){_.next=12;break}clientnode__WEBPACK_IMPORTED_MODULE_3___default().extend(!0,l,e.loadFile(d,r)),c.push(d);case 12:_.next=4;break;case 14:if(E=["index.js"],!Object.keys(l).length){_.next=22;break}return t=l.webNodeInternalName||t,(f=e.loadConfiguration(t,l,a.propertyNames))[t].package.main&&(E[0]=f[t].package.main),_.next=21,e.loadAPI(E,o,r,t,n,i,f,c);case 21:return _.abrupt("return",_.sent);case 22:return _.next=24,e.loadAPI(E,o,r,t,n,i);case 24:return _.abrupt("return",_.sent);case 25:case"end":return _.stop()}}),_)})));return function(){return _.apply(this,arguments)}}(),e.loadAPI=function(){var _=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_0___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default().mark((function _(r,t,n,a,o,i,c,l){var u,s,p,d,E,f,b,P,m,O,D;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default().wrap((function(_){for(;;)switch(_.prev=_.next){case 0:return void 0===i&&(i="utf8"),void 0===c&&(c=null),void 0===l&&(l=[]),E=(0,path__WEBPACK_IMPORTED_MODULE_6__.resolve)(t,r[0]),_.next=6,clientnode__WEBPACK_IMPORTED_MODULE_3___default().isFile(E);case 6:if(_.sent){_.next=21;break}f=_createForOfIteratorHelperLoose((0,fs__WEBPACK_IMPORTED_MODULE_4__.readdirSync)(t));case 8:if((b=f()).done){_.next=21;break}if(P=b.value,_.t0=!l.map((function(e){return(0,path__WEBPACK_IMPORTED_MODULE_6__.basename)(e)})).includes(P),!_.t0){_.next=15;break}return _.next=14,clientnode__WEBPACK_IMPORTED_MODULE_3___default().isFile((0,path__WEBPACK_IMPORTED_MODULE_6__.resolve)(t,P));case 14:_.t0=_.sent;case 15:if(!_.t0){_.next=19;break}if(E=(0,path__WEBPACK_IMPORTED_MODULE_6__.resolve)(t,E),!["index","main"].includes((0,path__WEBPACK_IMPORTED_MODULE_6__.basename)(E,(0,path__WEBPACK_IMPORTED_MODULE_6__.extname)(P)))){_.next=19;break}return _.abrupt("break",21);case 19:_.next=8;break;case 21:if(m=null,O=!1,_.t1=c&&(1<Object.keys(c).length||c[a]&&1<Object.keys(c[a]).length),!_.t1){_.next=28;break}return _.next=27,clientnode__WEBPACK_IMPORTED_MODULE_3___default().isFile(E);case 27:_.t1=_.sent;case 28:if(!_.t1){_.next=30;break}E.endsWith(".js")?(O=!0,m=function(_,r){for(var t,a=arguments.length,i=Array(2<a?a-2:0),c=2;c<a;c++)i[c-2]=arguments[c];if(_ in o[n].scope)return(t=o[n].scope)[_].apply(t,[r].concat(i,[e]));throw new Error('NotImplemented: API method "'+_+'" is not implemented in plugin "'+n+'".')}):m=function(e){for(var _=arguments.length,r=Array(1<_?_-1:0),t=1;t<_;t++)r[t-1]=arguments[t];var n=(0,child_process__WEBPACK_IMPORTED_MODULE_2__.spawnSync)(E,clientnode__WEBPACK_IMPORTED_MODULE_3___default().arrayMake(r),{cwd:process.cwd(),encoding:i,env:process.env,input:clientnode__WEBPACK_IMPORTED_MODULE_3___default().represent(e),shell:!0,stdio:"inherit"});return n.stdout.startsWith("##")&&n.stdout.endsWith("##")&&(e=JSON.parse(e)),e};case 30:return D=null!==(u=c)&&void 0!==u?u:((s={})[a]={package:{}},s),_.abrupt("return",{api:m,apiFileLoadTimestamps:m?[(0,fs__WEBPACK_IMPORTED_MODULE_4__.statSync)(E).mtime.getTime()]:[],apiFilePaths:m?[E]:[],configuration:D,configurationFilePaths:l,configurationFileLoadTimestamps:l.map((function(e){return(0,fs__WEBPACK_IMPORTED_MODULE_4__.statSync)(e).mtime.getTime()})),dependencies:(null==(p=D[a])?void 0:p.dependencies)||[],internalName:a,name:n,packageConfiguration:null==(d=D[a])?void 0:d.package,path:t,scope:O?e.loadFile(E,n):null});case 32:case"end":return _.stop()}}),_)})));return function(){return _.apply(this,arguments)}}(),e.loadConfiguration=function(e,_,r){for(var t,n,a,o=clientnode__WEBPACK_IMPORTED_MODULE_3___default().removeKeyPrefixes(clientnode__WEBPACK_IMPORTED_MODULE_3___default().copy(_)),i=((t={})[e]={package:o},t),c=_createForOfIteratorHelperLoose(r);!(n=c()).done;)if(_[a=n.value]){clientnode__WEBPACK_IMPORTED_MODULE_3___default().extend(!0,i,_[a]),delete i[e].package[a];break}return i},e.loadConfigurations=function(_,r){for(var t=0,n=Object.keys(r);t<n.length;t++)delete r[n[t]];clientnode__WEBPACK_IMPORTED_MODULE_3___default().extend(r,clientnode__WEBPACK_IMPORTED_MODULE_3___default().copy(_configurator__WEBPACK_IMPORTED_MODULE_7__.Z));for(var a,o,i=_createForOfIteratorHelperLoose(_);!(a=i()).done;)if((o=a.value).configuration){var c=clientnode__WEBPACK_IMPORTED_MODULE_3___default().copy(o.configuration);clientnode__WEBPACK_IMPORTED_MODULE_3___default().extend(!0,clientnode__WEBPACK_IMPORTED_MODULE_3___default().modifyObject(r,c),c),r.core.runtimeConfiguration&&clientnode__WEBPACK_IMPORTED_MODULE_3___default().extend(!0,r,r.core.runtimeConfiguration)}return e.evaluateConfiguration(r)},e.loadFile=function(e,_,r,t){var n,a;void 0===r&&(r=null),void 0===t&&(t=!0);try{n=currentRequire.resolve(e)}catch(e){}n&&n in currentRequire.cache&&delete currentRequire.cache[n];try{a=currentRequire(e)}catch(n){if(!r)throw new Error("Couln't load plugin file \""+e+'" for plugin "'+_+'": '+clientnode__WEBPACK_IMPORTED_MODULE_3___default().represent(n));a=r,t&&console.warn("Couln't load new api plugin file \""+e+'" for plugin "'+_+'": '+clientnode__WEBPACK_IMPORTED_MODULE_3___default().represent(n)+". Using fallback one.")}return Object.prototype.hasOwnProperty.call(a,"default")?a.default:a},e.loadAll=function(){var _=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_0___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default().mark((function _(r){var t,n,a,o,i,c,l,u,s,p,d,E,f,b,P,m,O,D,g,M,h,v,I,A,w,k;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default().wrap((function(_){for(;;)switch(_.prev=_.next){case 0:if(t={},"web-node"===r.name){_.next=5;break}return _.next=4,e.load(r.name,e.determineInternalName(r.name,new RegExp(r.core.plugin.directories.external.nameRegularExpressionPattern)),t,r.core.plugin.configuration,r.core.context.path,r.core.encoding);case 4:t[r.name]=_.sent;case 5:n=0,a=Object.values(r.core.plugin.directories);case 6:if(!(n<a.length)){_.next=27;break}return o=a[n],_.next=10,clientnode__WEBPACK_IMPORTED_MODULE_3___default().isDirectory(o.path);case 10:if(!_.sent){_.next=24;break}i=new RegExp(o.nameRegularExpressionPattern),c=_createForOfIteratorHelperLoose((0,fs__WEBPACK_IMPORTED_MODULE_4__.readdirSync)(o.path));case 13:if((l=c()).done){_.next=24;break}if(u=l.value,i.test(u)){_.next=17;break}return _.abrupt("continue",22);case 17:return s=(0,path__WEBPACK_IMPORTED_MODULE_6__.resolve)(o.path,u),p=e.determineInternalName(u,i),_.next=21,e.load(u,p,t,r.core.plugin.configuration,s,r.core.encoding);case 21:t[u]=_.sent;case 22:_.next=13;break;case 24:n++,_.next=6;break;case 27:for(d={},E=0,f=Object.values(t);E<f.length;E++)if(b=f[E],d[b.internalName]=b.dependencies,Object.prototype.hasOwnProperty.call(r.core.interDependencies,b.internalName))for(P=_createForOfIteratorHelperLoose([].concat(r.core.interDependencies[b.internalName]));!(m=P()).done;)O=m.value,d[b.internalName].includes(O)||d[b.internalName].push(O);D=[],g=_createForOfIteratorHelperLoose(clientnode__WEBPACK_IMPORTED_MODULE_3___default().arraySortTopological(d));case 31:if((M=g()).done){_.next=44;break}h=M.value,v=0,I=Object.entries(t);case 34:if(!(v<I.length)){_.next=42;break}if(A=I[v],w=A[0],![(k=A[1]).internalName,w].includes(h)){_.next=39;break}return D.push(k),_.abrupt("break",42);case 39:v++,_.next=34;break;case 42:_.next=31;break;case 44:return _.abrupt("return",{configuration:e.loadConfigurations(D,r),plugins:D});case 45:case"end":return _.stop()}}),_)})));return function(){return _.apply(this,arguments)}}(),e.determineLocations=function(e,_){return void 0===_&&(_=[]),(_=[].concat(_)).length?_.map((function(_){return(0,path__WEBPACK_IMPORTED_MODULE_6__.resolve)(e.core.context.path,_)})):[e.core.context.path]},e.isInLocations=function(e,_,r,t){for(var n,a,o=_.map((function(e){return e.path})),i=_createForOfIteratorHelperLoose([].concat(t));!(n=i()).done;)if((a=n.value).startsWith("/")){if(r.startsWith((0,path__WEBPACK_IMPORTED_MODULE_6__.join)(e.core.context.path,a)))return!0}else for(var c,l,u=_createForOfIteratorHelperLoose(o);!(c=u()).done;)if(l=c.value,r.startsWith((0,path__WEBPACK_IMPORTED_MODULE_6__.resolve)(l,a)))return!0;return!1},e}();const __WEBPACK_DEFAULT_EXPORT__=PluginAPI},(module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{PluginAPI:()=>_pluginAPI__WEBPACK_IMPORTED_MODULE_3__.Sw,configuration:()=>_configurator__WEBPACK_IMPORTED_MODULE_2__.D,currentRequire:()=>_pluginAPI__WEBPACK_IMPORTED_MODULE_3__.Jf,default:()=>__WEBPACK_DEFAULT_EXPORT__,main:()=>main});var _babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(3),_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_0__),_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(4),_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1__),_configurator__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(0),_pluginAPI__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(1),clientnode__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(5),clientnode__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(clientnode__WEBPACK_IMPORTED_MODULE_4__);function _createForOfIteratorHelperLoose(e,_){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=_unsupportedIterableToArray(e))||_&&e&&"number"==typeof e.length){r&&(e=r);var t=0;return function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,_){if(e){if("string"==typeof e)return _arrayLikeToArray(e,_);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,_):void 0}}function _arrayLikeToArray(e,_){(null==_||_>e.length)&&(_=e.length);for(var r=0,t=Array(_);r<_;r++)t[r]=e[r];return t}module=__webpack_require__.hmd(module);var handleError=function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_0___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default().mark((function e(_,r,t,n){return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,_pluginAPI__WEBPACK_IMPORTED_MODULE_3__.ZP.callStack("error",_,r,t,n);case 3:e.next=12;break;case 5:if(e.prev=5,e.t0=e.catch(0),!r.core.debug){e.next=11;break}throw e.t0;case 11:console.error(e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,5]])})));return function(){return e.apply(this,arguments)}}(),main=function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_0___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default().mark((function e(){var _,r,t,n,a,o,i,c,l,u,s,p,d,E,f,b,P,m,O,D,g,M,h,v;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_pluginAPI__WEBPACK_IMPORTED_MODULE_3__.ZP.loadAll(clientnode__WEBPACK_IMPORTED_MODULE_4___default().copy(_configurator__WEBPACK_IMPORTED_MODULE_2__.Z));case 2:return _=e.sent,r=_.configuration,t=_.plugins,e.next=7,_pluginAPI__WEBPACK_IMPORTED_MODULE_3__.ZP.callStack("initialize",t,r);case 7:t.length&&console.info('Loaded plugins: "'+t.map((function(e){return e.internalName})).join('", "')+'".'),n=_createForOfIteratorHelperLoose(["pre","post"]);case 9:if((a=n()).done){e.next=15;break}return o=a.value,e.next=13,_pluginAPI__WEBPACK_IMPORTED_MODULE_3__.ZP.callStack(o+"ConfigurationLoaded",t,r,r,t.filter((function(e){return!!e.configurationFilePaths.length})));case 13:e.next=9;break;case 15:return i={},c={},l=!1,e.prev=18,e.next=21,_pluginAPI__WEBPACK_IMPORTED_MODULE_3__.ZP.callStack("preLoadService",t,r,i);case 21:for(i=e.sent,u=0,s=Object.keys(i);u<s.length;u++)p=s[u],console.info('Service "'+p+'" initialized.');d=_createForOfIteratorHelperLoose(t);case 24:if((E=d()).done){e.next=47;break}if(!(f=E.value).api){e.next=45;break}return e.next=29,_pluginAPI__WEBPACK_IMPORTED_MODULE_3__.ZP.callStack("preLoad"+clientnode__WEBPACK_IMPORTED_MODULE_4___default().stringCapitalize(f.internalName)+"Service",t,r,i);case 29:return i=e.sent,P=null,e.prev=31,e.next=34,f.api.call(_pluginAPI__WEBPACK_IMPORTED_MODULE_3__.ZP,"loadService",c,i,r,t);case 34:P=e.sent,e.next=41;break;case 37:if(e.prev=37,e.t0=e.catch(31),null!=e.t0&&null!=(m=e.t0.message)&&m.startsWith("NotImplemented:")){e.next=41;break}throw new Error('Plugin "'+f.internalName+'" '+(f.internalName===f.name?"":"("+f.name+") ")+"throws: "+clientnode__WEBPACK_IMPORTED_MODULE_4___default().represent(e.t0)+' during asynchrone hook "loadService".');case 41:return"string"==typeof(null==(b=P)?void 0:b.name)&&(null!==P.promise&&"object"==typeof P.promise&&"then"in P.promise?(console.info('Service "'+P.name+'" started.'),c[P.name]=P.promise):console.info('Service "'+P.name+'" loaded.')),e.next=44,_pluginAPI__WEBPACK_IMPORTED_MODULE_3__.ZP.callStack("postLoad"+clientnode__WEBPACK_IMPORTED_MODULE_4___default().stringCapitalize(f.internalName)+"Service",t,r,i,c);case 44:i=e.sent;case 45:e.next=24;break;case 47:return e.next=49,_pluginAPI__WEBPACK_IMPORTED_MODULE_3__.ZP.callStack("postLoadService",t,r,c,i);case 49:for(c=e.sent,O=!1,D=function(){O||_pluginAPI__WEBPACK_IMPORTED_MODULE_3__.ZP.callStackSynchronous("exit",t.slice().reverse(),r,i),O=!0},g=_createForOfIteratorHelperLoose(clientnode__WEBPACK_IMPORTED_MODULE_4__.CloseEventNames);!(M=g()).done;)h=M.value,process.on(h,D);return v=!1,process.stdin.setRawMode(!0),process.stdin.resume(),process.stdin.setEncoding(r.core.encoding),process.stdin.on("data",(function(e){_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_0___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default().mark((function _(){return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default().wrap((function(_){for(;;)switch(_.prev=_.next){case 0:if(""!==e){_.next=10;break}if(!v){_.next=5;break}console.warn("Stopping ungracefully."),_.next=9;break;case 5:return v=!0,console.info("You have requested to shut down all services. A second request will force to stop ungracefully."),_.next=9,_pluginAPI__WEBPACK_IMPORTED_MODULE_3__.ZP.callStack("shouldExit",t,r,i);case 9:process.exit();case 10:process.stdout.write(e);case 11:case"end":return _.stop()}}),_)})))()})),e.prev=58,e.next=61,Promise.all(Object.keys(c).map((function(e){return c[e]})));case 61:e.next=65;break;case 63:e.prev=63,e.t1=e.catch(58);case 65:return l=!0,e.next=68,_pluginAPI__WEBPACK_IMPORTED_MODULE_3__.ZP.callStack("shouldExit",t,r,i);case 68:process.exit(),e.next=91;break;case 71:return e.prev=71,e.t2=e.catch(18),e.next=75,handleError(t,r,e.t2,i);case 75:if(l){e.next=85;break}return e.prev=76,e.next=79,_pluginAPI__WEBPACK_IMPORTED_MODULE_3__.ZP.callStack("shouldExit",t,r,i);case 79:e.next=85;break;case 81:return e.prev=81,e.t3=e.catch(76),e.next=85,handleError(t,r,e.t3,i);case 85:if(!r.core.debug){e.next=89;break}throw e.t2;case 89:console.error(e.t2);case 90:process.exit(1);case 91:case"end":return e.stop()}}),e,null,[[18,71],[31,37],[58,63],[76,81]])})));return function(){return e.apply(this,arguments)}}();(__webpack_require__.c[__webpack_require__.s]===module||eval("require.main")!==__webpack_require__.c[__webpack_require__.s]&&"undefined"!=typeof ORIGINAL_MAIN_MODULE&&ORIGINAL_MAIN_MODULE===eval("require.main"))&&main();const __WEBPACK_DEFAULT_EXPORT__=main},e=>{e.exports=require("@babel/runtime/helpers/asyncToGenerator")},e=>{e.exports=require("@babel/runtime/regenerator")},e=>{e.exports=require("clientnode")},e=>{e.exports=require("fs")},e=>{e.exports=require("path")},e=>{e.exports=require("child_process")},e=>{e.exports=require("module")}],__webpack_module_cache__={};function __webpack_require__(e){var _=__webpack_module_cache__[e];if(void 0!==_)return _.exports;var r=__webpack_module_cache__[e]={id:e,loaded:!1,exports:{}};return __webpack_modules__[e](r,r.exports,__webpack_require__),r.loaded=!0,r.exports}__webpack_require__.c=__webpack_module_cache__,__webpack_require__.n=e=>{var _=e&&e.__esModule?()=>e.default:()=>e;return __webpack_require__.d(_,{a:_}),_},__webpack_require__.d=(e,_)=>{for(var r in _)__webpack_require__.o(_,r)&&!__webpack_require__.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:_[r]})},__webpack_require__.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),__webpack_require__.o=(e,_)=>Object.prototype.hasOwnProperty.call(e,_),__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var __webpack_exports__=__webpack_require__(__webpack_require__.s=2);module.exports=__webpack_exports__})();