#!/usr/bin/env node
// -*- coding: utf-8 -*-
'use strict';if(typeof module!=='undefined'&&module!==null&&eval('typeof require')!=='undefined'&&eval('require')!==null&&'main'in eval('require')&&eval('typeof require.main')!=='undefined'&&eval('require.main')!==null){var ORIGINAL_MAIN_MODULE=module;if(module!==eval('require.main')&&'paths'in module&&'paths'in eval('require.main')&&typeof __dirname!=='undefined'&&__dirname!==null)module.paths=eval('require.main.paths').concat(module.paths.filter(function(path){return eval('require.main.paths').includes(path)}))};if(module===eval('require.main'))module.paths.unshift('/application/node_modules');(()=>{"use strict";var __webpack_modules__=[(e,_,r)=>{r.d(_,{D:()=>O,Z:()=>g});var t=r(6),n=r.n(t),a=r(7),o=r.n(a),i=r(8),l=r.n(i),c=r(1);const u=JSON.parse('{"name":"web-node","version":"1.0.463","description":"High level javaScript backend plugin system and configuration merger.","keywords":["web","backend","api","plugin","management"],"homepage":"https://torben.website/web-node","bugs":{"email":"info@torben.website","url":"https://github.com/thaibault/web-node/issues"},"license":"CC-BY-3.0","author":{"name":"Torben Sickert","email":"info@torben.website","url":"https://torben.website"},"files":["configurator.d.ts","index.d.ts","index.js","pluginAPI.d.ts","type.d.ts","unixCrypt.d.ts","unixCrypt.js"],"bin":{"web-node":"index.js"},"repository":{"type":"git","url":"https://github.com/thaibault/web-node.git"},"scripts":{"build":"yarn build:types; yarn build:plain","build:plain":"weboptimizer build","build:types":"weboptimizer build:types","check":"yarn check:types; yarn lint","check:types":"weboptimizer check:types","clear":"weboptimizer clear","document":"weboptimizer document","lint":"weboptimizer lint","postversion":"yarn publish --non-interactive; git push --tags && git push","prepare":"yarn build","serve":"weboptimizer build && yarn serve","start":"./index.js \'{plugin: {hotReloading: true}}\'","prepare:test":"yarn clear && cd dummyPlugin && yarn build && cd ..","test":"yarn prepare:test && weboptimizer test","test:coverage":"yarn prepare:test && weboptimizer test:coverage","test:coverage:report":"yarn prepare:test && weboptimizer test:coverage:report","update":"yarn version --patch","update:documentation":"documentation-website","watch":"weboptimizer build --watch"},"runkitExample":"require(\'@babel/runtime/package.json\')\\nrequire(\'clientnode/package.json\')\\n\\nconst {PluginAPI} = require(\'web-node\')\\n\\nPluginAPI.loadFile(\'./unixCrypt.js\', \'crypt\')(\'test\')","dependencies":{"@types/webpack":"https://registry.yarnpkg.com/@favware/skip-dependency/-/skip-dependency-1.1.1.tgz"},"devDependencies":{"@babel/cli":"*","@babel/eslint-parser":"*","@types/node":"*","@typescript-eslint/eslint-plugin":"*","@typescript-eslint/parser":"*","clientnode":"*","documentation-website":"*","eslint":"*","eslint-config-google":"*","eslint-plugin-jsdoc":"*","jest":"*","jsdoc":"*","weboptimizer":"*"},"peerDependencies":{"@babel/runtime":"*","clientnode":"*"},"peerDependenciesMeta":{"@babel/runtime":{"optional":true}},"engines":{"node":">=17","npm":">=7"},"resolutions":{"@types/webpack":"https://registry.yarnpkg.com/@favware/skip-dependency/-/skip-dependency-1.1.1.tgz","colors":"1.4.0"},"sideEffects":true,"documentationWebsite":{"name":"web-node","trackingCode":"UA-40192634-9"},"webNode":{"core":{"context":{"path":"./","type":"relative"},"debug":false,"encoding":"utf8","interDependencies":{},"name":"web-node","plugin":{"configuration":{"fileNames":["package.json","private-package.json"],"propertyNames":["webNode","webnode","web-node"]},"directories":{"external":{"nameRegularExpressionPattern":"^([a-zA-Z0-9-]+?)-?[wW]eb-?[nN]ode-?[pP]lugin$","path":{"__evaluate__":"`${currentPath}/node_modules/`"}},"internal":{"nameRegularExpressionPattern":"^([a-zA-Z0-9-_].*)$","path":{"__evaluate__":"`${currentPath}/plugins/`"}}},"hotReloading":false}}},"webOptimizer":{"assetPattern":{"javaScript":{"includeFilePathRegularExpression":"^(.+/)?index\\\\.js$","pattern":{"#":"This is how we can make our main exported artefact executable.","__evaluate__":"`#!/usr/bin/env node\\n// -*- coding: utf-8 -*-\\n${self.generic.assetPattern.javaScript.pattern}if(module===eval(\'require.main\'))module.paths.unshift(\'/application/node_modules\');{1}`"}}},"exportFormat":{"external":"commonjs2","self":"commonjs2"},"injection":{"entry":{"__evaluate__":"2 < self.givenCommandLineArguments.length && self.givenCommandLineArguments[2].startsWith(\'test\') ? {testBundle: \'test\'} : {index: \'./index.ts\', unixCrypt: \'./unixCrypt.ts\'}"}},"module":{"optimizer":{"babelMinify":{"#":"To provide a logging output we need to exclude this feature.","__evaluate__":"self.debug ? {bundle: null, module: null} : {bundle: {transform: {removeConsole: false}}, module: {removeConsole: false}}"}}},"targetTechnology":{"boilerplate":"node","payload":"node"}}}');var s,p;for(u.webNode.core.context={path:"/",type:"relative"};u.webNode.core.context.path=l().resolve(u.webNode.core.context.path,"../../"),"node_modules"===l().basename(l().dirname(u.webNode.core.context.path)););if("/"===u.webNode.core.context.path||"node_modules"===l().basename(l().dirname(process.cwd()))||".staging"===l().basename(l().dirname(process.cwd()))&&"node_modules"===l().basename(l().dirname(l().dirname(process.cwd()))))u.webNode.core.context.path=process.cwd();else try{(0,a.lstatSync)(l().join(process.cwd(),"node_modules")).isSymbolicLink()&&(u.webNode.core.context.path=process.cwd())}catch(e){}var d={name:"main"};try{d=(0,t.currentRequire)(l().join(u.webNode.core.context.path,"package"))}catch(e){u.webNode.core.context.path=process.cwd()}var E=(null==(s=d.documentationWebsite)?void 0:s.name)||d.name||"main",f=d.webNode||((p={})[E]={name:E,package:d},p);u.webNode.core.name=u.documentationWebsite.name;var b=new Date,P={currentPath:process.cwd(),fileSystem:o(),path:l(),PluginAPI:c.ZP,require:t.currentRequire,Tools:n(),webNodePath:"/",now:b,nowUTCTimestamp:n().numberGetUTCTimestamp(b)},O=n().evaluateDynamicData(u.webNode,P);if(delete u.webNode,n().extend(!0,n().modifyObject(O,f),f),2<process.argv.length){var m=n().stringParseEncodedObject(process.argv[process.argv.length-1],O,"configuration");n().isPlainObject(m)&&(n().extend(!0,n().modifyObject(O,m),m),O.core.runtimeConfiguration=m)}(O=n().evaluateDynamicData(n().removeKeysInEvaluation(O),P)).name=E,O.core.package=u;const g=O},(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{var __dirname="/";__webpack_require__.d(__webpack_exports__,{Jf:()=>currentRequire,Sw:()=>PluginAPI,ZP:()=>__WEBPACK_DEFAULT_EXPORT__});var _babel_runtime_helpers_extends__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(3),_babel_runtime_helpers_extends__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_babel_runtime_helpers_extends__WEBPACK_IMPORTED_MODULE_0__),_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(4),_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__),_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(5),_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_2__),child_process__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(9),child_process__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(child_process__WEBPACK_IMPORTED_MODULE_3__),clientnode__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(6),clientnode__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(clientnode__WEBPACK_IMPORTED_MODULE_4__),fs__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(7),fs__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(fs__WEBPACK_IMPORTED_MODULE_5__),module__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(10),module__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(module__WEBPACK_IMPORTED_MODULE_6__),path__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(8),path__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_7__),_configurator__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(0);function _createForOfIteratorHelperLoose(e,_){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=_unsupportedIterableToArray(e))||_&&e&&"number"==typeof e.length){r&&(e=r);var t=0;return function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,_){if(e){if("string"==typeof e)return _arrayLikeToArray(e,_);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,_):void 0}}function _arrayLikeToArray(e,_){(null==_||_>e.length)&&(_=e.length);for(var r=0,t=Array(_);r<_;r++)t[r]=e[r];return t}var currentRequire=eval("require"),oldResolveFilename=module__WEBPACK_IMPORTED_MODULE_6__.Module._resolveFilename;module__WEBPACK_IMPORTED_MODULE_6__.Module._resolveFilename=function(e,_,r){return oldResolveFilename("web-node"===e?currentRequire.main.id:e,_,r)};var PluginAPI=function(){function e(){}return e.callStack=function(){var _=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_2___default().mark((function _(r){var t,n,a,o,i,l,c,u,s,p,d,E,f,b,P,O,m,g=arguments;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_2___default().wrap((function(_){for(;;)switch(_.prev=_.next){case 0:if(t=_babel_runtime_helpers_extends__WEBPACK_IMPORTED_MODULE_0___default()({},r,{pluginAPI:e}),n=t.configuration,a=t.hook,o=t.plugins,i=a.endsWith("ConfigurationLoaded")||a.endsWith("ConfigurationHotLoaded"),!n.core.plugin.hotReloading){_.next=20;break}if(i){_.next=14;break}if(!(l=e.hotReloadConfigurationFile(o,n.core.plugin.configuration.propertyNames)).length){_.next=14;break}return n.core.debug&&console.info('Configuration for "'+l.map((function(e){return e.name})).join('", "')+'" has been changed: reloading initialized.'),c=_babel_runtime_helpers_extends__WEBPACK_IMPORTED_MODULE_0___default()({},t,{triggerHook:t.hook,pluginsWithChangedConfiguration:l}),_.next=11,e.callStack(_babel_runtime_helpers_extends__WEBPACK_IMPORTED_MODULE_0___default()({},c,{hook:"preConfigurationHotLoaded"}));case 11:return e.loadConfigurations(o,n),_.next=14,e.callStack(_babel_runtime_helpers_extends__WEBPACK_IMPORTED_MODULE_0___default()({},c,{hook:"postConfigurationHotLoaded"}));case 14:if("apiFileReloaded"===a){_.next=20;break}if(!(u=e.hotReloadAPIFile(o)).length){_.next=20;break}return n.core.debug&&console.info('API-file for "'+u.map((function(e){return e.name})).join('", "')+'" has been changed: reloading initialized.'),_.next=20,e.callStack(_babel_runtime_helpers_extends__WEBPACK_IMPORTED_MODULE_0___default()({},t,{hook:"apiFileReloaded",pluginsWithChangedAPIFiles:u,triggerHook:t.hook}));case 20:for(s=r.data,p=g.length,d=Array(1<p?p-1:0),E=1;E<p;E++)d[E-1]=g[E];f=_createForOfIteratorHelperLoose(o);case 23:if((b=f()).done){_.next=42;break}if(!(P=b.value).api){_.next=40;break}return O=void 0,_.prev=27,_.next=30,P.api.apply(P,[t].concat(d));case 30:O=_.sent,_.next=38;break;case 33:if(_.prev=33,_.t0=_.catch(27),null==(m=_.t0.message)||!m.startsWith("NotImplemented:")){_.next=37;break}return _.abrupt("continue",40);case 37:throw new Error('Plugin "'+P.internalName+'" '+(P.internalName===P.name?"":"("+P.name+") ")+"throws: "+clientnode__WEBPACK_IMPORTED_MODULE_4___default().represent(_.t0)+' during asynchronous hook "'+a+'".');case 38:s=O,n.core.debug&&console.info('Ran asynchronous hook "'+a+'" for plugin "'+P.name+'".');case 40:_.next=23;break;case 42:return _.abrupt("return",s);case 43:case"end":return _.stop()}}),_,null,[[27,33]])})));return function(){return _.apply(this,arguments)}}(),e.callStackSynchronous=function(_){for(var r=_babel_runtime_helpers_extends__WEBPACK_IMPORTED_MODULE_0___default()({},_,{pluginAPI:e}),t=r.configuration,n=r.hook,a=r.plugins,o=_.data,i=arguments.length,l=Array(1<i?i-1:0),c=1;c<i;c++)l[c-1]=arguments[c];for(var u,s,p=_createForOfIteratorHelperLoose(a);!(u=p()).done;)if((s=u.value).api){var d=void 0;try{d=s.api.apply(s,[r].concat(l))}catch(e){var E;if(null!=(E=e.message)&&E.startsWith("NotImplemented:"))continue;throw new Error('Plugin "'+s.internalName+'" '+(s.internalName===s.name?"":"("+s.name+") ")+"throws: "+clientnode__WEBPACK_IMPORTED_MODULE_4___default().represent(e)+' during synchronous hook "'+n+'".')}o=d,t.core.debug&&console.info('Ran synchronous hook "'+n+'" for plugin "'+s.name+'".')}return o},e.determineInternalName=function(e,_){return clientnode__WEBPACK_IMPORTED_MODULE_4___default().stringDelimitedToCamelCase(e.replace(_,(function(e,_){return"string"==typeof _?_:e})))},e.evaluateConfiguration=function(_){for(var r={},t=0,n=Object.entries(_);t<n.length;t++){var a=n[t],o=a[0],i=a[1];i.package&&(r[o]=i.package,delete i.package)}var l=new Date;_=clientnode__WEBPACK_IMPORTED_MODULE_4___default().evaluateDynamicData(clientnode__WEBPACK_IMPORTED_MODULE_4___default().removeKeysInEvaluation(_),{currentPath:process.cwd(),fileSystem:fs__WEBPACK_IMPORTED_MODULE_5___default(),path:path__WEBPACK_IMPORTED_MODULE_7___default(),PluginAPI:e,require:currentRequire,Tools:clientnode__WEBPACK_IMPORTED_MODULE_4___default(),webNodePath:__dirname,now:l,nowUTCTimestamp:clientnode__WEBPACK_IMPORTED_MODULE_4___default().numberGetUTCTimestamp(l)});for(var c=0,u=Object.entries(r);c<u.length;c++){var s=u[c],p=s[0],d=s[1];_[p].package=d}return _},e.hotReloadAPIFile=function(_){for(var r,t,n=[],a=_createForOfIteratorHelperLoose(e.hotReloadFiles("api","scope",_));!(r=a()).done;)if((t=r.value).oldScope){for(var o=0,i=Object.entries(t.oldScope);o<i.length;o++){var l=i[o],c=l[0],u=l[1];Object.prototype.hasOwnProperty.call(t.newScope,c)&&!clientnode__WEBPACK_IMPORTED_MODULE_4___default().isFunction(t.newScope[c])&&(t.newScope[c]=u)}n.push(t.plugin)}return n},e.hotReloadConfigurationFile=function(_,r){for(var t,n,a=[],o=_createForOfIteratorHelperLoose(e.hotReloadFiles("configuration","packageConfiguration",_));!(t=o()).done;)(n=t.value).plugin.configuration=e.loadConfiguration(n.plugin.internalName,n.plugin.packageConfiguration,r),a.push(n.plugin);return a},e.hotReloadFiles=function(_,r,t){for(var n,a,o=[],i=_createForOfIteratorHelperLoose(t);!(n=i()).done;)if((a=n.value)[r])for(var l,c=0,u=_createForOfIteratorHelperLoose(a[_+"FilePaths"]);!(l=u()).done;){var s=l.value,p=(0,fs__WEBPACK_IMPORTED_MODULE_5__.statSync)(s).mtime.getTime();if(a[_+"FileLoadTimestamps"][c]<p){delete currentRequire.cache[currentRequire.resolve(s)];var d=a[r];a[r]=e.loadFile(s,a.name,a[r]),o.push({newScope:a[r],oldScope:d,plugin:a,target:r})}a[_+"FileLoadTimestamps"][c]=p,c+=1}return o},e.load=function(){var _=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_2___default().mark((function _(r,t,n,a,o,i){var l,c,u,s,p,d,E,f;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_2___default().wrap((function(_){for(;;)switch(_.prev=_.next){case 0:void 0===i&&(i="utf8"),l=[],c={},u=_createForOfIteratorHelperLoose(a.fileNames);case 4:if((s=u()).done){_.next=14;break}return p=s.value,d=(0,path__WEBPACK_IMPORTED_MODULE_7__.resolve)(o,p),_.next=9,clientnode__WEBPACK_IMPORTED_MODULE_4___default().isFile(d);case 9:if(!_.sent){_.next=12;break}clientnode__WEBPACK_IMPORTED_MODULE_4___default().extend(!0,c,e.loadFile(d,r)),l.push(d);case 12:_.next=4;break;case 14:if(E=["index.js"],!Object.keys(c).length){_.next=22;break}return t=c.webNodeInternalName||t,(f=e.loadConfiguration(t,c,a.propertyNames))[t].package.main&&(E[0]=f[t].package.main),_.next=21,e.loadAPI(E,o,r,t,n,i,f,l);case 21:return _.abrupt("return",_.sent);case 22:return _.next=24,e.loadAPI(E,o,r,t,n,i);case 24:return _.abrupt("return",_.sent);case 25:case"end":return _.stop()}}),_)})));return function(){return _.apply(this,arguments)}}(),e.loadAPI=function(){var _=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_2___default().mark((function _(r,t,n,a,o,i,l,c){var u,s,p,d,E,f,b,P,O,m,g;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_2___default().wrap((function(_){for(;;)switch(_.prev=_.next){case 0:return void 0===i&&(i="utf8"),void 0===l&&(l=null),void 0===c&&(c=[]),E=(0,path__WEBPACK_IMPORTED_MODULE_7__.resolve)(t,r[0]),_.next=6,clientnode__WEBPACK_IMPORTED_MODULE_4___default().isFile(E);case 6:if(_.sent){_.next=21;break}f=_createForOfIteratorHelperLoose((0,fs__WEBPACK_IMPORTED_MODULE_5__.readdirSync)(t));case 8:if((b=f()).done){_.next=21;break}if(P=b.value,_.t0=!c.map((function(e){return(0,path__WEBPACK_IMPORTED_MODULE_7__.basename)(e)})).includes(P),!_.t0){_.next=15;break}return _.next=14,clientnode__WEBPACK_IMPORTED_MODULE_4___default().isFile((0,path__WEBPACK_IMPORTED_MODULE_7__.resolve)(t,P));case 14:_.t0=_.sent;case 15:if(!_.t0){_.next=19;break}if(E=(0,path__WEBPACK_IMPORTED_MODULE_7__.resolve)(t,E),!["index","main"].includes((0,path__WEBPACK_IMPORTED_MODULE_7__.basename)(E,(0,path__WEBPACK_IMPORTED_MODULE_7__.extname)(P)))){_.next=19;break}return _.abrupt("break",21);case 19:_.next=8;break;case 21:if(O=null,m=!1,_.t1=l&&(1<Object.keys(l).length||l[a]&&1<Object.keys(l[a]).length),!_.t1){_.next=28;break}return _.next=27,clientnode__WEBPACK_IMPORTED_MODULE_4___default().isFile(E);case 27:_.t1=_.sent;case 28:if(!_.t1){_.next=30;break}E.endsWith(".js")?(m=!0,O=function(_){for(var r,t=arguments.length,a=Array(1<t?t-1:0),i=1;i<t;i++)a[i-1]=arguments[i];if(_.hook in o[n].scope)return(r=o[n].scope)[_.hook].apply(r,[_].concat(a,[e]));throw new Error('NotImplemented: API method "'+_.hook+'" is not implemented in plugin "'+n+'".')}):O=function(e){for(var _=e.hook,r=e.data,t=arguments.length,n=Array(1<t?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];var o=(0,child_process__WEBPACK_IMPORTED_MODULE_3__.spawnSync)(E,[_].concat(n.map((function(e){return JSON.stringify(e)}))),{cwd:process.cwd(),encoding:i,env:process.env,input:JSON.stringify(r),shell:!0,stdio:"inherit"});return 404===o.status?r:o.stdout.startsWith("##!JSON!##")?JSON.parse(o.stdout.substring(10)):r};case 30:return g=null!==(u=l)&&void 0!==u?u:((s={})[a]={package:{}},s),_.abrupt("return",{api:O,apiFileLoadTimestamps:O?[(0,fs__WEBPACK_IMPORTED_MODULE_5__.statSync)(E).mtime.getTime()]:[],apiFilePaths:O?[E]:[],configuration:g,configurationFilePaths:c,configurationFileLoadTimestamps:c.map((function(e){return(0,fs__WEBPACK_IMPORTED_MODULE_5__.statSync)(e).mtime.getTime()})),dependencies:(null==(p=g[a])?void 0:p.dependencies)||[],internalName:a,name:n,packageConfiguration:null==(d=g[a])?void 0:d.package,path:t,scope:m?e.loadFile(E,n):null});case 32:case"end":return _.stop()}}),_)})));return function(){return _.apply(this,arguments)}}(),e.loadConfiguration=function(e,_,r){for(var t,n,a,o=clientnode__WEBPACK_IMPORTED_MODULE_4___default().removeKeyPrefixes(clientnode__WEBPACK_IMPORTED_MODULE_4___default().copy(_)),i=((t={})[e]={package:o},t),l=_createForOfIteratorHelperLoose(r);!(n=l()).done;)if(_[a=n.value]){clientnode__WEBPACK_IMPORTED_MODULE_4___default().extend(!0,i,_[a]),delete i[e].package[a];break}return i},e.loadConfigurations=function(_,r){for(var t=0,n=Object.keys(r);t<n.length;t++)delete r[n[t]];clientnode__WEBPACK_IMPORTED_MODULE_4___default().extend(r,clientnode__WEBPACK_IMPORTED_MODULE_4___default().copy(_configurator__WEBPACK_IMPORTED_MODULE_8__.Z));for(var a,o,i=_createForOfIteratorHelperLoose(_);!(a=i()).done;)if((o=a.value).configuration){var l=clientnode__WEBPACK_IMPORTED_MODULE_4___default().copy(o.configuration);clientnode__WEBPACK_IMPORTED_MODULE_4___default().extend(!0,clientnode__WEBPACK_IMPORTED_MODULE_4___default().modifyObject(r,l),l),r.core.runtimeConfiguration&&clientnode__WEBPACK_IMPORTED_MODULE_4___default().extend(!0,r,r.core.runtimeConfiguration)}return e.evaluateConfiguration(r)},e.loadFile=function(e,_,r,t){var n,a;void 0===r&&(r=null),void 0===t&&(t=!0);try{n=currentRequire.resolve(e)}catch(e){}n&&n in currentRequire.cache&&delete currentRequire.cache[n];try{a=currentRequire(e)}catch(n){if(!r)throw new Error("Couln't load plugin file \""+e+'" for plugin "'+_+'": '+clientnode__WEBPACK_IMPORTED_MODULE_4___default().represent(n));a=r,t&&console.warn("Couln't load new api plugin file \""+e+'" for plugin "'+_+'": '+clientnode__WEBPACK_IMPORTED_MODULE_4___default().represent(n)+". Using fallback one.")}return Object.prototype.hasOwnProperty.call(a,"default")?a.default:a},e.loadAll=function(){var _=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_2___default().mark((function _(r){var t,n,a,o,i,l,c,u,s,p,d,E,f,b,P,O,m,g,D,M,h,v,k,I,A,w;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_2___default().wrap((function(_){for(;;)switch(_.prev=_.next){case 0:if(t={},"web-node"===r.name){_.next=5;break}return _.next=4,e.load(r.name,e.determineInternalName(r.name,new RegExp(r.core.plugin.directories.external.nameRegularExpressionPattern)),t,r.core.plugin.configuration,r.core.context.path,r.core.encoding);case 4:t[r.name]=_.sent;case 5:n=0,a=Object.values(r.core.plugin.directories);case 6:if(!(n<a.length)){_.next=27;break}return o=a[n],_.next=10,clientnode__WEBPACK_IMPORTED_MODULE_4___default().isDirectory(o.path);case 10:if(!_.sent){_.next=24;break}i=new RegExp(o.nameRegularExpressionPattern),l=_createForOfIteratorHelperLoose((0,fs__WEBPACK_IMPORTED_MODULE_5__.readdirSync)(o.path));case 13:if((c=l()).done){_.next=24;break}if(u=c.value,i.test(u)){_.next=17;break}return _.abrupt("continue",22);case 17:return s=(0,path__WEBPACK_IMPORTED_MODULE_7__.resolve)(o.path,u),p=e.determineInternalName(u,i),_.next=21,e.load(u,p,t,r.core.plugin.configuration,s,r.core.encoding);case 21:t[u]=_.sent;case 22:_.next=13;break;case 24:n++,_.next=6;break;case 27:for(d={},E=0,f=Object.values(t);E<f.length;E++)if(b=f[E],d[b.internalName]=b.dependencies,Object.prototype.hasOwnProperty.call(r.core.interDependencies,b.internalName))for(P=_createForOfIteratorHelperLoose([].concat(r.core.interDependencies[b.internalName]));!(O=P()).done;)m=O.value,d[b.internalName].includes(m)||d[b.internalName].push(m);g=[],D=_createForOfIteratorHelperLoose(clientnode__WEBPACK_IMPORTED_MODULE_4___default().arraySortTopological(d));case 31:if((M=D()).done){_.next=44;break}h=M.value,v=0,k=Object.entries(t);case 34:if(!(v<k.length)){_.next=42;break}if(I=k[v],A=I[0],![(w=I[1]).internalName,A].includes(h)){_.next=39;break}return g.push(w),_.abrupt("break",42);case 39:v++,_.next=34;break;case 42:_.next=31;break;case 44:return _.abrupt("return",{configuration:e.loadConfigurations(g,r),plugins:g});case 45:case"end":return _.stop()}}),_)})));return function(){return _.apply(this,arguments)}}(),e.determineLocations=function(e,_){var r=e.core.context.path;return void 0===_&&(_=[]),(_=[].concat(_)).length?_.map((function(e){return(0,path__WEBPACK_IMPORTED_MODULE_7__.resolve)(r,e)})):[r]},e.isInLocations=function(e,_,r,t){for(var n,a,o=_.map((function(e){return e.path})),i=_createForOfIteratorHelperLoose([].concat(t));!(n=i()).done;)if((a=n.value).startsWith("/")){if(r.startsWith((0,path__WEBPACK_IMPORTED_MODULE_7__.join)(e.core.context.path,a)))return!0}else for(var l,c,u=_createForOfIteratorHelperLoose(o);!(l=u()).done;)if(c=l.value,r.startsWith((0,path__WEBPACK_IMPORTED_MODULE_7__.resolve)(c,a)))return!0;return!1},e}();const __WEBPACK_DEFAULT_EXPORT__=PluginAPI},(module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{PluginAPI:()=>_pluginAPI__WEBPACK_IMPORTED_MODULE_4__.Sw,configuration:()=>_configurator__WEBPACK_IMPORTED_MODULE_3__.D,currentRequire:()=>_pluginAPI__WEBPACK_IMPORTED_MODULE_4__.Jf,default:()=>__WEBPACK_DEFAULT_EXPORT__,main:()=>main});var _babel_runtime_helpers_extends__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(3),_babel_runtime_helpers_extends__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_babel_runtime_helpers_extends__WEBPACK_IMPORTED_MODULE_0__),_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(4),_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__),_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(5),_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_2__),_configurator__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(0),_pluginAPI__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(1),clientnode__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(6),clientnode__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(clientnode__WEBPACK_IMPORTED_MODULE_5__);function _createForOfIteratorHelperLoose(e,_){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=_unsupportedIterableToArray(e))||_&&e&&"number"==typeof e.length){r&&(e=r);var t=0;return function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,_){if(e){if("string"==typeof e)return _arrayLikeToArray(e,_);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,_):void 0}}function _arrayLikeToArray(e,_){(null==_||_>e.length)&&(_=e.length);for(var r=0,t=Array(_);r<_;r++)t[r]=e[r];return t}module=__webpack_require__.hmd(module);var handleError=function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_2___default().mark((function e(_){return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_2___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,_pluginAPI__WEBPACK_IMPORTED_MODULE_4__.ZP.callStack(_babel_runtime_helpers_extends__WEBPACK_IMPORTED_MODULE_0___default()({},_,{hook:"error"}));case 3:e.next=12;break;case 5:if(e.prev=5,e.t0=e.catch(0),!_.configuration.core.debug){e.next=11;break}throw e.t0;case 11:console.error(e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,5]])})));return function(){return e.apply(this,arguments)}}(),main=function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_2___default().mark((function e(){var _,r,t,n,a,o,i,l,c,u,s,p,d,E,f,b,P,O,m,g,D,M,h,v,k,I,A,w,T;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_2___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_pluginAPI__WEBPACK_IMPORTED_MODULE_4__.ZP.loadAll(clientnode__WEBPACK_IMPORTED_MODULE_5___default().copy(_configurator__WEBPACK_IMPORTED_MODULE_3__.Z));case 2:return _=e.sent,r=_.configuration,t=_.plugins,e.next=7,_pluginAPI__WEBPACK_IMPORTED_MODULE_4__.ZP.callStack({configuration:r,hook:"initialize",plugins:t});case 7:t.length&&console.info('Loaded plugins: "'+t.map((function(e){return e.internalName})).join('", "')+'".'),n=t.filter((function(e){return!!e.configurationFilePaths.length})),a=_createForOfIteratorHelperLoose(["pre","post"]);case 10:if((o=a()).done){e.next=16;break}return i=o.value,e.next=14,_pluginAPI__WEBPACK_IMPORTED_MODULE_4__.ZP.callStack({configuration:r,hook:i+"ConfigurationLoaded",plugins:t,pluginsWithChangedConfiguration:n});case 14:e.next=10;break;case 16:return l={},c={},u=!1,e.prev=19,e.next=22,_pluginAPI__WEBPACK_IMPORTED_MODULE_4__.ZP.callStack({configuration:r,hook:"preLoadService",plugins:t,services:l});case 22:for(s=0,p=Object.keys(l);s<p.length;s++)d=p[s],console.info('Service "'+d+'" initialized.');E=_createForOfIteratorHelperLoose(t);case 24:if((f=E()).done){e.next=45;break}if(!(b=f.value).api){e.next=43;break}return e.next=29,_pluginAPI__WEBPACK_IMPORTED_MODULE_4__.ZP.callStack({configuration:r,hook:"preLoad"+clientnode__WEBPACK_IMPORTED_MODULE_5___default().stringCapitalize(b.internalName)+"Service",plugins:t,services:l});case 29:return P=null,e.prev=30,e.next=33,b.api({configuration:r,hook:"loadService",pluginAPI:_pluginAPI__WEBPACK_IMPORTED_MODULE_4__.ZP,plugins:t,servicePromises:c,services:l});case 33:P=e.sent,e.next=40;break;case 36:if(e.prev=36,e.t0=e.catch(30),null!=e.t0&&null!=(O=e.t0.message)&&O.startsWith("NotImplemented:")){e.next=40;break}throw new Error('Plugin "'+b.internalName+'" '+(b.internalName===b.name?"":"("+b.name+") ")+"throws: "+clientnode__WEBPACK_IMPORTED_MODULE_5___default().represent(e.t0)+' during asynchrone hook "loadService".');case 40:if(P)for(m=0,g=Object.entries(P);m<g.length;m++)D=g[m],M=D[0],null!==(h=D[1])&&"object"==typeof h&&"then"in h?(console.info('Service "'+M+'" started.'),c[M]=h):console.info('Service "'+M+'" loaded.');return e.next=43,_pluginAPI__WEBPACK_IMPORTED_MODULE_4__.ZP.callStack({configuration:r,hook:"postLoad"+clientnode__WEBPACK_IMPORTED_MODULE_5___default().stringCapitalize(b.internalName)+"Service",plugins:t,services:l,servicePromises:c});case 43:e.next=24;break;case 45:return e.next=47,_pluginAPI__WEBPACK_IMPORTED_MODULE_4__.ZP.callStack({configuration:r,hook:"postLoadService",plugins:t,servicePromises:c,services:l});case 47:for(v=!1,k=function(){v||_pluginAPI__WEBPACK_IMPORTED_MODULE_4__.ZP.callStackSynchronous({configuration:r,hook:"exit",plugins:t.slice().reverse(),servicePromises:c,services:l}),v=!0},I=_createForOfIteratorHelperLoose(clientnode__WEBPACK_IMPORTED_MODULE_5__.CloseEventNames);!(A=I()).done;)w=A.value,process.on(w,k);return T=!1,clientnode__WEBPACK_IMPORTED_MODULE_5___default().isFunction(process.stdin.setRawMode)&&process.stdin.setRawMode(!0),process.stdin.resume(),process.stdin.setEncoding(r.core.encoding),process.stdin.on("data",(function(e){_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_2___default().mark((function _(){return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_2___default().wrap((function(_){for(;;)switch(_.prev=_.next){case 0:if(""!==e){_.next=10;break}if(!T){_.next=5;break}console.warn("Stopping ungracefully."),_.next=9;break;case 5:return T=!0,console.info("You have requested to shut down all services. A second request will force to stop ungracefully."),_.next=9,_pluginAPI__WEBPACK_IMPORTED_MODULE_4__.ZP.callStack({configuration:r,hook:"shouldExit",plugins:t,servicePromises:c,services:l});case 9:process.exit();case 10:process.stdout.write(e);case 11:case"end":return _.stop()}}),_)})))()})),e.prev=55,e.next=58,Promise.all(Object.keys(c).map((function(e){return c[e]})));case 58:e.next=62;break;case 60:e.prev=60,e.t1=e.catch(55);case 62:return u=!0,e.next=65,_pluginAPI__WEBPACK_IMPORTED_MODULE_4__.ZP.callStack({configuration:r,hook:"shouldExit",plugins:t,servicePromises:c,services:l});case 65:process.exit(),e.next=88;break;case 68:return e.prev=68,e.t2=e.catch(19),e.next=72,handleError({configuration:r,data:e.t2,plugins:t,servicePromises:c,services:l});case 72:if(u){e.next=82;break}return e.prev=73,e.next=76,_pluginAPI__WEBPACK_IMPORTED_MODULE_4__.ZP.callStack({configuration:r,hook:"shouldExit",plugins:t,servicePromises:c,services:l});case 76:e.next=82;break;case 78:return e.prev=78,e.t3=e.catch(73),e.next=82,handleError({configuration:r,data:e.t3,plugins:t,servicePromises:c,services:l});case 82:if(!r.core.debug){e.next=86;break}throw e.t2;case 86:console.error(e.t2);case 87:process.exit(1);case 88:case"end":return e.stop()}}),e,null,[[19,68],[30,36],[55,60],[73,78]])})));return function(){return e.apply(this,arguments)}}();(__webpack_require__.c[__webpack_require__.s]===module||eval("require.main")!==__webpack_require__.c[__webpack_require__.s]&&"undefined"!=typeof ORIGINAL_MAIN_MODULE&&ORIGINAL_MAIN_MODULE===eval("require.main"))&&main();const __WEBPACK_DEFAULT_EXPORT__=main},e=>{e.exports=require("@babel/runtime/helpers/extends")},e=>{e.exports=require("@babel/runtime/helpers/asyncToGenerator")},e=>{e.exports=require("@babel/runtime/regenerator")},e=>{e.exports=require("clientnode")},e=>{e.exports=require("fs")},e=>{e.exports=require("path")},e=>{e.exports=require("child_process")},e=>{e.exports=require("module")}],__webpack_module_cache__={};function __webpack_require__(e){var _=__webpack_module_cache__[e];if(void 0!==_)return _.exports;var r=__webpack_module_cache__[e]={id:e,loaded:!1,exports:{}};return __webpack_modules__[e](r,r.exports,__webpack_require__),r.loaded=!0,r.exports}__webpack_require__.c=__webpack_module_cache__,__webpack_require__.n=e=>{var _=e&&e.__esModule?()=>e.default:()=>e;return __webpack_require__.d(_,{a:_}),_},__webpack_require__.d=(e,_)=>{for(var r in _)__webpack_require__.o(_,r)&&!__webpack_require__.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:_[r]})},__webpack_require__.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),__webpack_require__.o=(e,_)=>Object.prototype.hasOwnProperty.call(e,_),__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var __webpack_exports__=__webpack_require__(__webpack_require__.s=2);module.exports=__webpack_exports__})();